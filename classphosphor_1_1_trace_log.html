<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Phosphor: phosphor::TraceLog Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Phosphor
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('classphosphor_1_1_trace_log.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="#pro-static-attribs">Static Protected Attributes</a>  </div>
  <div class="headertitle">
<div class="title">phosphor::TraceLog Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="phosphor::TraceLog" -->
<p><code>#include &lt;<a class="el" href="trace__log_8h_source.html">trace_log.h</a>&gt;</code></p>

<p><a href="classphosphor_1_1_trace_log-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structphosphor_1_1_trace_log_1_1_chunk_tenant.html">ChunkTenant</a></td></tr>
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classphosphor_1_1_trace_log.html#ae86d34004e257bd6a45442a634370231">TraceLog</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classphosphor_1_1_trace_log.html#a22fde18331507432721f09e70f35822e">start</a> (const <a class="el" href="classphosphor_1_1_trace_config.html">TraceConfig</a> &amp;_trace_config)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classphosphor_1_1_trace_log.html#ad61c9956ecb142c03260ab9a430914a2">stop</a> ()</td></tr>
<tr><td class="memTemplParams" colspan="2">template&lt;typename T , typename U &gt; </td></tr>
<tr><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classphosphor_1_1_trace_log.html#ac17965235daaff2cb2ecf38040549c68">logEvent</a> (const char *category, const char *name, <a class="el" href="classphosphor_1_1_trace_event.html#a85fb2bc9c88252db9716a3ecce209ddf">TraceEvent::Type</a> type, size_t id, T argA, U argB)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::unique_ptr&lt; <a class="el" href="classphosphor_1_1_trace_buffer.html">TraceBuffer</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classphosphor_1_1_trace_log.html#a47bd45e0cec58a6315aeab78a0562469">getBuffer</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classphosphor_1_1_trace_log.html#ae5cc67e6a17aec48a3b5beb1acb28d5f">isEnabled</a> ()</td></tr>
<tr><td colspan="2"><h2><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classphosphor_1_1_trace_log.html">TraceLog</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classphosphor_1_1_trace_log.html#ade38924fc3174ca43696c6432f05c658">getInstance</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classphosphor_1_1_trace_log.html#ab1fbcb3a1285fd447b4d8df6f6fccd8e">registerThread</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classphosphor_1_1_trace_log.html#ad5456184843a1f01db7614a3053e98b8">deregisterThread</a> (<a class="el" href="classphosphor_1_1_trace_log.html">TraceLog</a> &amp;instance=<a class="el" href="classphosphor_1_1_trace_log.html#ade38924fc3174ca43696c6432f05c658">TraceLog::getInstance</a>())</td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classphosphor_1_1_trace_log.html#a45bae635204891e31084169815917184">replaceChunk</a> (<a class="el" href="structphosphor_1_1_trace_log_1_1_chunk_tenant.html">ChunkTenant</a> &amp;ct)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classphosphor_1_1_trace_log.html#a7072d5d2fa370d231b6c93490d2180ca">resetChunk</a> (<a class="el" href="structphosphor_1_1_trace_log_1_1_chunk_tenant.html">ChunkTenant</a> &amp;ct)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classphosphor_1_1_trace_log.html#a9b46069e80adb1d3deedb32074953119">stopUNLOCKED</a> ()</td></tr>
<tr><td colspan="2"><h2><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classphosphor_1_1_trace_config.html">TraceConfig</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classphosphor_1_1_trace_log.html#a366b267a03ceffcc9aaa4daf2561cbaf">trace_config</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::atomic_bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classphosphor_1_1_trace_log.html#a433797901dd0c7b1015f13ef729e34b4">enabled</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::mutex&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classphosphor_1_1_trace_log.html#a51a113a9a75825d65aa7d235eeefd4fb">mutex</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::unique_ptr&lt; <a class="el" href="classphosphor_1_1_trace_buffer.html">TraceBuffer</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classphosphor_1_1_trace_log.html#a7c26730cdfcd9a5006933bb3440253c2">buffer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classphosphor_1_1_trace_log.html#aaba5b955aca310f4bd5eda20ab7432d0">generation</a> = 0</td></tr>
<tr><td colspan="2"><h2><a name="pro-static-attribs"></a>
Static Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static THREAD_LOCAL <a class="el" href="structphosphor_1_1_trace_log_1_1_chunk_tenant.html">ChunkTenant</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classphosphor_1_1_trace_log.html#a05712ecaf10a3183c16c8f44c5c7b092">thread_chunk</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structphosphor_1_1_trace_log_1_1_chunk_tenant.html">ChunkTenant</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classphosphor_1_1_trace_log.html#a13b3cedfe336d3c66e8acdcae92c81d1">shared_chunk</a></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>The <a class="el" href="classphosphor_1_1_trace_log.html">TraceLog</a> class is the main public management interface of Phosphor. Generally the <a class="el" href="classphosphor_1_1_trace_log.html">TraceLog</a> is used as a singleton, this instance is acquired via <a class="el" href="classphosphor_1_1_trace_log.html#ade38924fc3174ca43696c6432f05c658">TraceLog::getInstance()</a>.</p>
<p>Logging can be enabled by passing in a <a class="el" href="classphosphor_1_1_trace_config.html">TraceConfig</a> object with the desired options to the TraceConfig::start() method:</p>
<p>// Enable tracing with a fixed buffer, 5 megabytes in size <a class="el" href="classphosphor_1_1_trace_log.html#ade38924fc3174ca43696c6432f05c658">TraceLog::getInstance()</a>.start(TraceConfig(BufferMode::fixed, 5))</p>
<p>Once enabled, tracing will be logged wherever code has been instrumented with the instrumentation API described in <a class="el" href="phosphor_8h.html">phosphor.h</a>.</p>
<p>This class's public interface is *generally* thread-safe. </p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="ae86d34004e257bd6a45442a634370231"></a><!-- doxytag: member="phosphor::TraceLog::TraceLog" ref="ae86d34004e257bd6a45442a634370231" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classphosphor_1_1_trace_log.html#ae86d34004e257bd6a45442a634370231">phosphor::TraceLog::TraceLog</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Default constructor for <a class="el" href="classphosphor_1_1_trace_log.html">TraceLog</a> </p>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="ad5456184843a1f01db7614a3053e98b8"></a><!-- doxytag: member="phosphor::TraceLog::deregisterThread" ref="ad5456184843a1f01db7614a3053e98b8" args="(TraceLog &amp;instance=TraceLog::getInstance())" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classphosphor_1_1_trace_log.html#ad5456184843a1f01db7614a3053e98b8">phosphor::TraceLog::deregisterThread</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classphosphor_1_1_trace_log.html">TraceLog</a> &amp;&#160;</td>
          <td class="paramname"><em>instance</em> = <code><a class="el" href="classphosphor_1_1_trace_log.html#ade38924fc3174ca43696c6432f05c658">TraceLog::getInstance</a>()</code></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>De-registers the current thread</p>
<p>De-registering will free up any resources associated with the thread. This MUST be called from registered threads before they shutdown to prevent memory-leaks as the only reference to resources they allocate are in thread local storage.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">instance</td><td>The <a class="el" href="classphosphor_1_1_trace_log.html">TraceLog</a> instance that the sentinel is using </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a47bd45e0cec58a6315aeab78a0562469"></a><!-- doxytag: member="phosphor::TraceLog::getBuffer" ref="a47bd45e0cec58a6315aeab78a0562469" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::unique_ptr&lt; <a class="el" href="classphosphor_1_1_trace_buffer.html">TraceBuffer</a> &gt; <a class="el" href="classphosphor_1_1_trace_log.html#a47bd45e0cec58a6315aeab78a0562469">phosphor::TraceLog::getBuffer</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Transfers ownership of the current <a class="el" href="classphosphor_1_1_trace_buffer.html">TraceBuffer</a> to the caller</p>
<p>Should only be called while Tracing is disabled. The returned unique_ptr is not guaranteed to be non-null, and in fact *will* be null if the buffer has previously been retrieved.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd><a class="el" href="classphosphor_1_1_trace_buffer.html">TraceBuffer</a> </dd></dl>
<dl class="exception"><dt><b>Exceptions:</b></dt><dd>
  <table class="exception">
    <tr><td class="paramname">std::logic_error</td><td>if tracing is currently enabled </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ade38924fc3174ca43696c6432f05c658"></a><!-- doxytag: member="phosphor::TraceLog::getInstance" ref="ade38924fc3174ca43696c6432f05c658" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classphosphor_1_1_trace_log.html">TraceLog</a> &amp; <a class="el" href="classphosphor_1_1_trace_log.html#ade38924fc3174ca43696c6432f05c658">phosphor::TraceLog::getInstance</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Singleton static method to get the <a class="el" href="classphosphor_1_1_trace_log.html">TraceLog</a> instance</p>
<p>This is technically ThreadSafe according to the C++11 spec but versions of MSVC &lt; 2015 are not *quite* conforming.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>the <a class="el" href="classphosphor_1_1_trace_log.html">TraceLog</a> instance </dd></dl>

</div>
</div>
<a class="anchor" id="ae5cc67e6a17aec48a3b5beb1acb28d5f"></a><!-- doxytag: member="phosphor::TraceLog::isEnabled" ref="ae5cc67e6a17aec48a3b5beb1acb28d5f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classphosphor_1_1_trace_log.html#ae5cc67e6a17aec48a3b5beb1acb28d5f">phosphor::TraceLog::isEnabled</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Get the current state of tracing of this <a class="el" href="classphosphor_1_1_trace_log.html">TraceLog</a></p>
<dl class="return"><dt><b>Returns:</b></dt><dd>True if tracing is enabled, False if tracing is disabled </dd></dl>

</div>
</div>
<a class="anchor" id="ac17965235daaff2cb2ecf38040549c68"></a><!-- doxytag: member="phosphor::TraceLog::logEvent" ref="ac17965235daaff2cb2ecf38040549c68" args="(const char *category, const char *name, TraceEvent::Type type, size_t id, T argA, U argB)" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T , typename U &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classphosphor_1_1_trace_log.html#ac17965235daaff2cb2ecf38040549c68">phosphor::TraceLog::logEvent</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>category</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classphosphor_1_1_trace_event.html#a85fb2bc9c88252db9716a3ecce209ddf">TraceEvent::Type</a>&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">T&#160;</td>
          <td class="paramname"><em>argA</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">U&#160;</td>
          <td class="paramname"><em>argB</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Logs an event in the current buffer (if applicable)</p>
<p>This method should not be used directly, instead the macros contained within <a class="el" href="sentinel_8h.html">sentinel.h</a> should be used instead.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">category</td><td>The category to log the event into. This (and the name) should usually be a string literal as the pointer should remain valid until the buffer is freed. </td></tr>
    <tr><td class="paramname">name</td><td>The name of the event </td></tr>
    <tr><td class="paramname">type</td><td>The type of the event </td></tr>
    <tr><td class="paramname">id</td><td>The id of the event, primarily used for async events </td></tr>
    <tr><td class="paramname">argA</td><td>Argument to be saved with the event </td></tr>
    <tr><td class="paramname">argB</td><td>Argument to be saved with the event </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ab1fbcb3a1285fd447b4d8df6f6fccd8e"></a><!-- doxytag: member="phosphor::TraceLog::registerThread" ref="ab1fbcb3a1285fd447b4d8df6f6fccd8e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classphosphor_1_1_trace_log.html#ab1fbcb3a1285fd447b4d8df6f6fccd8e">phosphor::TraceLog::registerThread</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Registers the current thread for tracing (Optional)</p>
<p>Registering a thread is used for a long-living thread and is used to give it a dedicated <a class="el" href="structphosphor_1_1_trace_log_1_1_chunk_tenant.html">ChunkTenant</a> and optionally a name. A registered thread MUST be de-registered before the thread is joined as the act of registering allocates resources only accessibly via thread -local storage.</p>
<p>Registering is desirable as the thread will otherwise share a <a class="el" href="structphosphor_1_1_trace_log_1_1_chunk_tenant.html">ChunkTenant</a> with all other non-registered threads. Because this involves acquiring locks that may be under contention this can be expensive. </p>

</div>
</div>
<a class="anchor" id="a45bae635204891e31084169815917184"></a><!-- doxytag: member="phosphor::TraceLog::replaceChunk" ref="a45bae635204891e31084169815917184" args="(ChunkTenant &amp;ct)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classphosphor_1_1_trace_log.html#a45bae635204891e31084169815917184">phosphor::TraceLog::replaceChunk</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structphosphor_1_1_trace_log_1_1_chunk_tenant.html">ChunkTenant</a> &amp;&#160;</td>
          <td class="paramname"><em>ct</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Replaces the current chunk held by the <a class="el" href="structphosphor_1_1_trace_log_1_1_chunk_tenant.html">ChunkTenant</a> with a new chunk (typically because it is full).</p>
<p>This function must be called while the <a class="el" href="structphosphor_1_1_trace_log_1_1_chunk_tenant.html">ChunkTenant</a> sentinel is held in the 'Busy' state (via <a class="el" href="classphosphor_1_1_sentinel.html#ae63eab2f17eec6b5530bfa56da1b27eb">Sentinel::acquire</a> or <a class="el" href="classphosphor_1_1_sentinel.html#a7ead8e098b98397cf731e5e5733a9215">Sentinel::reopen</a>).</p>
<p>This function internally performs some lock juggling as it requires the global lock and the global lock must not be picked up while holding a <a class="el" href="classphosphor_1_1_sentinel.html">Sentinel</a> busy lock (Otherwise deadlock may occur). Therefore the sentinel is released, the global lock is picked up and then sentinel is reacquired. The global lock is dropped before the function is returned from.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">ct</td><td>The <a class="el" href="structphosphor_1_1_trace_log_1_1_chunk_tenant.html">ChunkTenant</a> that should have it's chunk returned and replaced </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a7072d5d2fa370d231b6c93490d2180ca"></a><!-- doxytag: member="phosphor::TraceLog::resetChunk" ref="a7072d5d2fa370d231b6c93490d2180ca" args="(ChunkTenant &amp;ct)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classphosphor_1_1_trace_log.html#a7072d5d2fa370d231b6c93490d2180ca">phosphor::TraceLog::resetChunk</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structphosphor_1_1_trace_log_1_1_chunk_tenant.html">ChunkTenant</a> &amp;&#160;</td>
          <td class="paramname"><em>ct</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Resets the current chunk held by the <a class="el" href="structphosphor_1_1_trace_log_1_1_chunk_tenant.html">ChunkTenant</a> (because the <a class="el" href="structphosphor_1_1_trace_log_1_1_chunk_tenant.html">ChunkTenant</a> has been evicted by the buffer)</p>
<p>This function should be called when the <a class="el" href="structphosphor_1_1_trace_log_1_1_chunk_tenant.html">ChunkTenant</a> is found to be closed. This is so that the eviction from the buffer can be acknowledged and the reference to the chunk removed. Once this has been done the chunk can be transitioned back into the Open state. </p>

</div>
</div>
<a class="anchor" id="a22fde18331507432721f09e70f35822e"></a><!-- doxytag: member="phosphor::TraceLog::start" ref="a22fde18331507432721f09e70f35822e" args="(const TraceConfig &amp;_trace_config)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classphosphor_1_1_trace_log.html#a22fde18331507432721f09e70f35822e">phosphor::TraceLog::start</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classphosphor_1_1_trace_config.html">TraceConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>_trace_config</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Start tracing with the specified config</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">_trace_config</td><td><a class="el" href="classphosphor_1_1_trace_config.html">TraceConfig</a> to use for this tracing run </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ad61c9956ecb142c03260ab9a430914a2"></a><!-- doxytag: member="phosphor::TraceLog::stop" ref="ad61c9956ecb142c03260ab9a430914a2" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classphosphor_1_1_trace_log.html#ad61c9956ecb142c03260ab9a430914a2">phosphor::TraceLog::stop</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Immediately stops tracing </p>

</div>
</div>
<a class="anchor" id="a9b46069e80adb1d3deedb32074953119"></a><!-- doxytag: member="phosphor::TraceLog::stopUNLOCKED" ref="a9b46069e80adb1d3deedb32074953119" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classphosphor_1_1_trace_log.html#a9b46069e80adb1d3deedb32074953119">phosphor::TraceLog::stopUNLOCKED</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Immediately stops tracing while the global lock is held. </p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a7c26730cdfcd9a5006933bb3440253c2"></a><!-- doxytag: member="phosphor::TraceLog::buffer" ref="a7c26730cdfcd9a5006933bb3440253c2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::unique_ptr&lt;<a class="el" href="classphosphor_1_1_trace_buffer.html">TraceBuffer</a>&gt; <a class="el" href="classphosphor_1_1_trace_log.html#a7c26730cdfcd9a5006933bb3440253c2">phosphor::TraceLog::buffer</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>buffer is the current buffer that is being used by the <a class="el" href="classphosphor_1_1_trace_log.html">TraceLog</a>.</p>
<p>While logging is enabled the buffer will have various chunks of the buffer loaned out.</p>
<p>This buffer may become NULL once tracing stops if a user asks for it as movement semantics are used and buffers are only created when tracing starts. </p>

</div>
</div>
<a class="anchor" id="a433797901dd0c7b1015f13ef729e34b4"></a><!-- doxytag: member="phosphor::TraceLog::enabled" ref="a433797901dd0c7b1015f13ef729e34b4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::atomic_bool <a class="el" href="classphosphor_1_1_trace_log.html#a433797901dd0c7b1015f13ef729e34b4">phosphor::TraceLog::enabled</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Whether or not tracing is currently enabled</p>
<p>By transitioning this boolean to false no new trace events will be logged, but any threads currently in the process of tracing an event MAY finish tracing the event they're on. </p>

</div>
</div>
<a class="anchor" id="aaba5b955aca310f4bd5eda20ab7432d0"></a><!-- doxytag: member="phosphor::TraceLog::generation" ref="aaba5b955aca310f4bd5eda20ab7432d0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t <a class="el" href="classphosphor_1_1_trace_log.html#aaba5b955aca310f4bd5eda20ab7432d0">phosphor::TraceLog::generation</a> = 0<code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The current tracing generation. This is incremented every-time tracing is stopped and is passed into the <a class="el" href="classphosphor_1_1_trace_buffer.html">TraceBuffer</a> when it is constructed in order to 'uniquely' identify it. </p>

</div>
</div>
<a class="anchor" id="a51a113a9a75825d65aa7d235eeefd4fb"></a><!-- doxytag: member="phosphor::TraceLog::mutex" ref="a51a113a9a75825d65aa7d235eeefd4fb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::mutex <a class="el" href="classphosphor_1_1_trace_log.html#a51a113a9a75825d65aa7d235eeefd4fb">phosphor::TraceLog::mutex</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>mutex is the 'global' lock for the <a class="el" href="classphosphor_1_1_trace_log.html">TraceLog</a> and should be acquired when modifying the <a class="el" href="classphosphor_1_1_trace_log.html">TraceLog</a> itself or the current <a class="el" href="classphosphor_1_1_trace_buffer.html">TraceBuffer</a>.</p>
<p>It is not required to be acquired when modifying a loaned out <a class="el" href="classphosphor_1_1_trace_buffer_chunk.html">TraceBufferChunk</a> contained within a <a class="el" href="structphosphor_1_1_trace_log_1_1_chunk_tenant.html">ChunkTenant</a>, this is protected by the <a class="el" href="structphosphor_1_1_trace_log_1_1_chunk_tenant.html">ChunkTenant</a>'s sentinel lock instead. </p>

</div>
</div>
<a class="anchor" id="a13b3cedfe336d3c66e8acdcae92c81d1"></a><!-- doxytag: member="phosphor::TraceLog::shared_chunk" ref="a13b3cedfe336d3c66e8acdcae92c81d1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structphosphor_1_1_trace_log_1_1_chunk_tenant.html">TraceLog::ChunkTenant</a> <a class="el" href="classphosphor_1_1_trace_log.html#a13b3cedfe336d3c66e8acdcae92c81d1">phosphor::TraceLog::shared_chunk</a><code> [static, protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The shared <a class="el" href="structphosphor_1_1_trace_log_1_1_chunk_tenant.html">ChunkTenant</a> which is used be default when a thread has not been registered.</p>
<p>This is because we need to guarantee that the resources in the thread-specific chunk will be at some point freed up. </p>

</div>
</div>
<a class="anchor" id="a05712ecaf10a3183c16c8f44c5c7b092"></a><!-- doxytag: member="phosphor::TraceLog::thread_chunk" ref="a05712ecaf10a3183c16c8f44c5c7b092" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">THREAD_LOCAL <a class="el" href="structphosphor_1_1_trace_log_1_1_chunk_tenant.html">TraceLog::ChunkTenant</a> <a class="el" href="classphosphor_1_1_trace_log.html#a05712ecaf10a3183c16c8f44c5c7b092">phosphor::TraceLog::thread_chunk</a><code> [static, protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The thread-specific <a class="el" href="structphosphor_1_1_trace_log_1_1_chunk_tenant.html">ChunkTenant</a> used for low contention</p>
<p>This <a class="el" href="structphosphor_1_1_trace_log_1_1_chunk_tenant.html">ChunkTenant</a> is only used when the current thread has been registered as it requires resources allocated that are only referred to from thread-local storage. </p>

</div>
</div>
<a class="anchor" id="a366b267a03ceffcc9aaa4daf2561cbaf"></a><!-- doxytag: member="phosphor::TraceLog::trace_config" ref="a366b267a03ceffcc9aaa4daf2561cbaf" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classphosphor_1_1_trace_config.html">TraceConfig</a> <a class="el" href="classphosphor_1_1_trace_log.html#a366b267a03ceffcc9aaa4daf2561cbaf">phosphor::TraceLog::trace_config</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The current or last-used <a class="el" href="classphosphor_1_1_trace_config.html">TraceConfig</a> of the <a class="el" href="classphosphor_1_1_trace_log.html">TraceLog</a>, this is only ever set by the <a class="el" href="classphosphor_1_1_trace_log.html#a22fde18331507432721f09e70f35822e">start()</a> method.</p>
<p>This is a full copy of a <a class="el" href="classphosphor_1_1_trace_config.html">TraceConfig</a> rather than a reference to allow reuse / modification of a <a class="el" href="classphosphor_1_1_trace_config.html">TraceConfig</a> that was passed in by a user. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>include/phosphor/<a class="el" href="trace__log_8h_source.html">trace_log.h</a></li>
<li>src/trace_log.cc</li>
</ul>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><b>phosphor</b>      </li>
      <li class="navelem"><a class="el" href="classphosphor_1_1_trace_log.html">TraceLog</a>      </li>

    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
